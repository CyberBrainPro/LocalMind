import{_ as D,r as k,a as $,k as H,o as I,c as a,b as s,t as r,u as V,w as x,v as T,d as v,F as g,e as S,h as o,l as m,m as B,i as z,j as U}from"./plugin-vue_export-helper.ed441a23.js";const O={id:"app"},q={class:"header"},R={class:"header-right"},Y={class:"main"},G={class:"panel"},K={class:"input-row"},Q={class:"input-col"},W={class:"input-col"},X={style:{display:"flex","align-items":"flex-end"}},Z=["disabled"],tt={key:0},st={key:1},et={class:"search-row"},nt={class:"folders-list"},at={key:0,style:{"font-size":"12px",color:"var(--text-soft)",padding:"4px 2px"}},ot={class:"folder-main"},rt={class:"folder-name"},lt={class:"folder-path"},it={class:"folder-meta"},dt={key:0,class:"progress-box"},ct={class:"progress-bar"},ut={class:"folder-actions"},pt=["onClick","disabled"],vt={key:0},_t={key:1},ht=["onClick"],mt=["onClick"],yt={class:"panel"},ft={class:"jobs-list"},gt={key:0,style:{"font-size":"12px",color:"var(--text-soft)"}},bt={class:"job-header"},wt={class:"job-meta"},kt={key:0,class:"job-meta"},$t={key:0,style:{color:"#fecaca"}},xt={key:0,class:"error"},Tt={__name:"AdminApp",setup(St){const u=typeof window!="undefined"&&(window.__LOCALMIND_API__||{}.VITE_API_BASE)||"http://127.0.0.1:8787",c=k([]),_=$(""),d=k({name:"",path:""}),y=$(!1),h=k([]),i=$(""),f=async()=>{try{i.value="",c.splice(0,c.length);const e=new URL(`${u}/folders`);_.value.trim()&&e.searchParams.set("q",_.value.trim());const t=await fetch(e.toString());if(!t.ok)throw new Error(`HTTP ${t.status}`);((await t.json()).items||[]).forEach(l=>{c.push({...l,scanning:!1,currentJob:null})})}catch(e){console.error(e),i.value="\u52A0\u8F7D\u6587\u4EF6\u5939\u914D\u7F6E\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u540E\u7AEF\u670D\u52A1\u3002"}},E=async()=>{if(!d.name.trim()||!d.path.trim()){i.value="\u540D\u79F0\u548C\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A\u3002";return}try{i.value="",y.value=!0;const e=await fetch(`${u}/folders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:d.name.trim(),path:d.path.trim()})});if(!e.ok){const n=await e.text();throw new Error(`HTTP ${e.status} ${n}`)}const t=await e.json();c.push({...t,scanning:!1,currentJob:null}),d.name="",d.path=""}catch(e){console.error(e),i.value=`\u521B\u5EFA\u6587\u4EF6\u5939\u914D\u7F6E\u5931\u8D25\uFF1A${e.message}`}finally{y.value=!1}},A=async e=>{if(!!confirm(`\u786E\u5B9A\u8981\u5220\u9664\u300C${e.name}\u300D\u8FD9\u4E2A\u914D\u7F6E\u5417\uFF1F`))try{const t=await fetch(`${u}/folders/${e.id}`,{method:"DELETE"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=c.findIndex(l=>l.id===e.id);n>=0&&c.splice(n,1)}catch(t){console.error(t),i.value=`\u5220\u9664\u914D\u7F6E\u5931\u8D25\uFF1A${t.message}`}},b=async()=>{try{i.value="",h.splice(0,h.length);const e=await fetch(`${u}/scan-jobs`);if(!e.ok)throw new Error(`HTTP ${e.status}`);(await e.json()||[]).forEach(n=>h.push(n))}catch(e){console.error(e),i.value=`\u52A0\u8F7D\u626B\u63CF\u4EFB\u52A1\u5931\u8D25\uFF1A${e.message}`}},C=e=>{switch(e){case"pending":return"\u7B49\u5F85\u4E2D";case"running":return"\u626B\u63CF\u4E2D";case"completed":return"\u5DF2\u5B8C\u6210";case"error":return"\u51FA\u9519";default:return e||"\u672A\u77E5"}},J=e=>{if(!e||!e.total_files)return 0;const t=e.processed_files/e.total_files*100;return Math.max(5,Math.min(100,Math.round(t)))},P=async(e,t)=>{const n=async()=>{try{const l=await fetch(`${u}/scan-jobs/${t}`);if(!l.ok)throw new Error(`HTTP ${l.status}`);const p=await l.json();e.currentJob=p,e.scanning=p.status==="pending"||p.status==="running",p.status==="pending"||p.status==="running"?setTimeout(n,1500):(b(),f())}catch(l){console.error(l),e.scanning=!1}};n()},L=async e=>{try{i.value="",e.scanning=!0,e.currentJob=null;const t=await fetch(`${u}/folders/${e.id}/scan`,{method:"POST"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json();e.currentJob=n,P(e,n.id)}catch(t){console.error(t),i.value=`\u542F\u52A8\u626B\u63CF\u5931\u8D25\uFF1A${t.message}`,e.scanning=!1}},w=e=>{if(!e)return"-";const t=new Date(e);if(Number.isNaN(t.getTime()))return e;const n=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),p=String(t.getDate()).padStart(2,"0"),N=String(t.getHours()).padStart(2,"0"),j=String(t.getMinutes()).padStart(2,"0");return`${n}-${l}-${p} ${N}:${j}`},M=H(()=>{const e=_.value.trim().toLowerCase();return e?c.filter(t=>t.name.toLowerCase().includes(e)||(t.path||"").toLowerCase().includes(e)):c}),F=()=>{window.open("/chat","_blank")};return I(()=>{f(),b()}),(e,t)=>(o(),a("div",O,[s("div",q,[t[7]||(t[7]=s("div",{class:"brand"},[s("div",{class:"logo"},"LM"),s("div",null,[s("div",{class:"title"},"LocalMind Admin"),s("div",{class:"subtitle"},"\u672C\u5730\u77E5\u8BC6\u5E93 \xB7 \u6587\u4EF6\u5939\u76D1\u63A7\u4E0E\u5411\u91CF\u5316\u7BA1\u7406")])],-1)),s("div",R,[t[3]||(t[3]=s("div",{class:"status-dot"},null,-1)),s("span",null,"Backend: "+r(V(u)),1),t[4]||(t[4]=s("span",{class:"badge"},"Admin",-1)),t[5]||(t[5]=s("a",{href:"/vectors",class:"nav-link"},"\u67E5\u770B\u5411\u91CF",-1)),t[6]||(t[6]=s("a",{href:"/chat",class:"nav-link"},"\u8FD4\u56DE\u5BF9\u8BDD",-1))])]),s("div",Y,[s("div",G,[s("div",{class:"panel-header"},[t[8]||(t[8]=s("div",{class:"panel-title"},"\u76D1\u63A7\u6587\u4EF6\u5939\u914D\u7F6E",-1)),s("button",{class:"btn btn-secondary",onClick:f},"\u5237\u65B0")]),t[14]||(t[14]=s("div",{class:"panel-desc"}," \u4E3A 1-N \u4E2A\u670D\u52A1\u5668 / \u76EE\u5F55\u5EFA\u7ACB\u914D\u7F6E\uFF0C\u70B9\u51FB\u201C\u626B\u63CF\u201D\u540E\u81EA\u52A8\u5207\u5206\u5E76\u5411\u91CF\u5316\u5176\u4E2D\u7684\u6587\u672C\u6587\u4EF6\u3002 ",-1)),s("div",K,[s("div",Q,[t[9]||(t[9]=s("label",null,"\u540D\u79F0",-1)),x(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>d.name=n),placeholder:"\u5982\uFF1A\u672C\u673A-\u9879\u76EE\u6587\u6863"},null,512),[[T,d.name]])]),s("div",W,[t[10]||(t[10]=s("label",null,"\u76EE\u5F55\u8DEF\u5F84",-1)),x(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>d.path=n),placeholder:"\u5982\uFF1A/Users/xxx/Documents/project-notes"},null,512),[[T,d.path]])]),s("div",X,[s("button",{class:"btn btn-primary",onClick:E,disabled:y.value},[y.value?(o(),a("span",st,"\u6DFB\u52A0\u4E2D...")):(o(),a("span",tt,"\u6DFB\u52A0\u6587\u4EF6\u5939"))],8,Z)])]),s("div",et,[t[11]||(t[11]=s("label",{style:{"font-size":"11px",color:"var(--text-soft)"}},"\u641C\u7D22\uFF1A",-1)),x(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>_.value=n),placeholder:"\u6309\u540D\u79F0\u6216\u8DEF\u5F84\u8FC7\u6EE4"},null,512),[[T,_.value]]),s("button",{class:"btn btn-secondary",onClick:f},"\u91CD\u8F7D")]),s("div",nt,[c.length===0?(o(),a("div",at," \u8FD8\u6CA1\u6709\u914D\u7F6E\u4EFB\u4F55\u76D1\u63A7\u6587\u4EF6\u5939\uFF0C\u8BF7\u5148\u5728\u4E0A\u65B9\u6DFB\u52A0\u3002 ")):v("",!0),(o(!0),a(g,null,S(M.value,n=>(o(),a("div",{key:n.id,class:"folder-row"},[s("div",ot,[s("div",rt,r(n.name),1),s("div",lt,r(n.path),1),s("div",it,[s("span",null,[t[12]||(t[12]=m(" \u6700\u8FD1\u626B\u63CF\uFF1A ",-1)),n.last_scan_at?(o(),a(g,{key:0},[m(r(w(n.last_scan_at))+"\uFF08"+r(n.last_scan_status||"\u672A\u77E5\u72B6\u6001")+"\uFF09 ",1)],64)):(o(),a(g,{key:1},[m("\u5C1A\u672A\u626B\u63CF")],64))])])]),s("div",null,[n.currentJob?(o(),a("div",dt,[s("div",null,[t[13]||(t[13]=m(" \u72B6\u6001\uFF1A",-1)),s("strong",null,r(C(n.currentJob.status)),1),m(" \uFF08"+r(n.currentJob.processed_files)+" / "+r(n.currentJob.total_files)+" \u6587\u4EF6\uFF09 ",1)]),s("div",ct,[s("div",{class:"progress-inner",style:B({width:J(n.currentJob)+"%"})},null,4)])])):v("",!0)]),s("div",ut,[s("button",{class:"btn btn-primary",onClick:l=>L(n),disabled:n.scanning},[n.scanning?(o(),a("span",_t,"\u626B\u63CF\u4E2D...")):(o(),a("span",vt,"\u626B\u63CF\u5E76\u5411\u91CF\u5316"))],8,pt),s("button",{class:"btn btn-secondary",onClick:l=>F()},"\u5728 Chat \u4E2D\u63D0\u95EE",8,ht),s("button",{class:"btn btn-danger",onClick:l=>A(n)},"\u5220\u9664\u914D\u7F6E",8,mt)])]))),128))])]),s("div",yt,[s("div",{class:"panel-header"},[t[15]||(t[15]=s("div",{class:"panel-title"},"\u626B\u63CF\u4EFB\u52A1 / \u8FDB\u5EA6",-1)),s("button",{class:"btn btn-secondary",onClick:b},"\u5237\u65B0")]),t[16]||(t[16]=s("div",{class:"panel-desc"},"\u67E5\u770B\u5F53\u524D\u548C\u5386\u53F2\u626B\u63CF\u4EFB\u52A1\u7684\u8FDB\u5EA6\uFF0C\u4FBF\u4E8E\u8DDF\u8E2A\u6279\u91CF\u5411\u91CF\u5316\u8FC7\u7A0B\u3002",-1)),s("div",ft,[h.length===0?(o(),a("div",gt," \u6682\u65E0\u626B\u63CF\u4EFB\u52A1\u3002\u4F60\u53EF\u4EE5\u5728\u5DE6\u4FA7\u5BF9\u67D0\u4E2A\u6587\u4EF6\u5939\u53D1\u8D77\u4E00\u6B21\u626B\u63CF\u3002 ")):v("",!0),(o(!0),a(g,null,S(h,n=>(o(),a("div",{key:n.id,class:"job-row"},[s("div",bt,[s("div",null,"\u4EFB\u52A1 "+r(n.id.slice(0,8))+"...",1),s("div",{class:z(["job-status",n.status])},r(C(n.status)),3)]),s("div",wt,[s("span",null,"\u6587\u4EF6\u6570\uFF1A"+r(n.processed_files)+" / "+r(n.total_files),1),s("span",null,"\u5F00\u59CB\uFF1A"+r(w(n.started_at)),1)]),n.finished_at?(o(),a("div",kt,[s("span",null,"\u7ED3\u675F\uFF1A"+r(w(n.finished_at)),1),n.error_message?(o(),a("span",$t,r(n.error_message),1)):v("",!0)])):v("",!0)]))),128))]),i.value?(o(),a("div",xt,"\u26A0\uFE0F "+r(i.value),1)):v("",!0)])])]))}};var Ct=D(Tt,[["__scopeId","data-v-1a053756"]]);U(Ct).mount("#app");
