import{_ as j,r as k,a as $,l as D,o as H,c as a,b as s,t as l,u as I,w as x,v as T,d as v,F as y,e as S,h as B,i as o,m,p as z,j as U,k as O}from"./plugin-vue_export-helper.898ebc61.js";const q={class:"app-shell"},R={class:"shell-header"},Y={class:"header-right"},G={class:"shell-body"},K={class:"panel-grid"},Q={class:"panel"},W={class:"input-row"},X={class:"input-col"},Z={class:"input-col"},tt={style:{display:"flex","align-items":"flex-end"}},st=["disabled"],et={key:0},nt={key:1},at={class:"search-row"},ot={class:"folders-list"},lt={key:0,style:{"font-size":"12px",color:"var(--text-soft)",padding:"4px 2px"}},rt={class:"folder-main"},it={class:"folder-name"},dt={class:"folder-path"},ct={class:"folder-meta"},ut={key:0,class:"progress-box"},pt={class:"progress-bar"},vt={class:"folder-actions"},_t=["onClick","disabled"],ht={key:0},mt={key:1},ft=["onClick"],bt=["onClick"],yt={class:"panel"},gt={class:"jobs-list"},wt={key:0,style:{"font-size":"12px",color:"var(--text-soft)"}},kt={class:"job-header"},$t={class:"job-meta"},xt={key:0,class:"job-meta"},Tt={key:0,style:{color:"#fecaca"}},Ct={key:0,class:"error"},St={__name:"AdminApp",setup(At){const u=typeof window!="undefined"&&(window.__LOCALMIND_API__||{}.VITE_API_BASE)||"http://127.0.0.1:8787",c=k([]),_=$(""),d=k({name:"",path:""}),f=$(!1),h=k([]),i=$(""),b=async()=>{try{i.value="",c.splice(0,c.length);const e=new URL(`${u}/folders`);_.value.trim()&&e.searchParams.set("q",_.value.trim());const t=await fetch(e.toString());if(!t.ok)throw new Error(`HTTP ${t.status}`);((await t.json()).items||[]).forEach(r=>{c.push({...r,scanning:!1,currentJob:null})})}catch(e){console.error(e),i.value="\u52A0\u8F7D\u6587\u4EF6\u5939\u914D\u7F6E\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u540E\u7AEF\u670D\u52A1\u3002"}},E=async()=>{if(!d.name.trim()||!d.path.trim()){i.value="\u540D\u79F0\u548C\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A\u3002";return}try{i.value="",f.value=!0;const e=await fetch(`${u}/folders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:d.name.trim(),path:d.path.trim()})});if(!e.ok){const n=await e.text();throw new Error(`HTTP ${e.status} ${n}`)}const t=await e.json();c.push({...t,scanning:!1,currentJob:null}),d.name="",d.path=""}catch(e){console.error(e),i.value=`\u521B\u5EFA\u6587\u4EF6\u5939\u914D\u7F6E\u5931\u8D25\uFF1A${e.message}`}finally{f.value=!1}},A=async e=>{if(!!confirm(`\u786E\u5B9A\u8981\u5220\u9664\u300C${e.name}\u300D\u8FD9\u4E2A\u914D\u7F6E\u5417\uFF1F`))try{const t=await fetch(`${u}/folders/${e.id}`,{method:"DELETE"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=c.findIndex(r=>r.id===e.id);n>=0&&c.splice(n,1)}catch(t){console.error(t),i.value=`\u5220\u9664\u914D\u7F6E\u5931\u8D25\uFF1A${t.message}`}},g=async()=>{try{i.value="",h.splice(0,h.length);const e=await fetch(`${u}/scan-jobs`);if(!e.ok)throw new Error(`HTTP ${e.status}`);(await e.json()||[]).forEach(n=>h.push(n))}catch(e){console.error(e),i.value=`\u52A0\u8F7D\u626B\u63CF\u4EFB\u52A1\u5931\u8D25\uFF1A${e.message}`}},C=e=>{switch(e){case"pending":return"\u7B49\u5F85\u4E2D";case"running":return"\u626B\u63CF\u4E2D";case"completed":return"\u5DF2\u5B8C\u6210";case"error":return"\u51FA\u9519";default:return e||"\u672A\u77E5"}},J=e=>{if(!e||!e.total_files)return 0;const t=e.processed_files/e.total_files*100;return Math.max(5,Math.min(100,Math.round(t)))},L=async(e,t)=>{const n=async()=>{try{const r=await fetch(`${u}/scan-jobs/${t}`);if(!r.ok)throw new Error(`HTTP ${r.status}`);const p=await r.json();e.currentJob=p,e.scanning=p.status==="pending"||p.status==="running",p.status==="pending"||p.status==="running"?setTimeout(n,1500):(g(),b())}catch(r){console.error(r),e.scanning=!1}};n()},P=async e=>{try{i.value="",e.scanning=!0,e.currentJob=null;const t=await fetch(`${u}/folders/${e.id}/scan`,{method:"POST"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json();e.currentJob=n,L(e,n.id)}catch(t){console.error(t),i.value=`\u542F\u52A8\u626B\u63CF\u5931\u8D25\uFF1A${t.message}`,e.scanning=!1}},w=e=>{if(!e)return"-";const t=new Date(e);if(Number.isNaN(t.getTime()))return e;const n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),p=String(t.getDate()).padStart(2,"0"),F=String(t.getHours()).padStart(2,"0"),V=String(t.getMinutes()).padStart(2,"0");return`${n}-${r}-${p} ${F}:${V}`},M=D(()=>{const e=_.value.trim().toLowerCase();return e?c.filter(t=>t.name.toLowerCase().includes(e)||(t.path||"").toLowerCase().includes(e)):c}),N=()=>{window.open("/chat","_blank")};return H(()=>{b(),g()}),(e,t)=>(o(),a("div",q,[s("div",R,[t[7]||(t[7]=s("div",{class:"brand"},[s("div",{class:"logo"},"LM"),s("div",null,[s("div",{class:"title"},"LocalMind Admin"),s("div",{class:"subtitle"},"\u672C\u5730\u77E5\u8BC6\u5E93 \xB7 \u6587\u4EF6\u5939\u76D1\u63A7\u4E0E\u5411\u91CF\u5316\u7BA1\u7406")])],-1)),s("div",Y,[t[3]||(t[3]=s("div",{class:"status-dot"},null,-1)),s("span",null,"Backend: "+l(I(u)),1),t[4]||(t[4]=s("span",{class:"badge"},"Admin",-1)),t[5]||(t[5]=s("a",{href:"/vectors",class:"nav-link"},"\u67E5\u770B\u5411\u91CF",-1)),t[6]||(t[6]=s("a",{href:"/chat",class:"nav-link"},"\u8FD4\u56DE\u5BF9\u8BDD",-1))])]),s("div",G,[s("div",K,[s("div",Q,[s("div",{class:"panel-header"},[t[8]||(t[8]=s("div",{class:"panel-title"},"\u76D1\u63A7\u6587\u4EF6\u5939\u914D\u7F6E",-1)),s("button",{class:"btn btn-secondary",onClick:b},"\u5237\u65B0")]),t[14]||(t[14]=s("div",{class:"panel-desc"}," \u4E3A 1-N \u4E2A\u670D\u52A1\u5668 / \u76EE\u5F55\u5EFA\u7ACB\u914D\u7F6E\uFF0C\u70B9\u51FB\u201C\u626B\u63CF\u201D\u540E\u81EA\u52A8\u5207\u5206\u5E76\u5411\u91CF\u5316\u5176\u4E2D\u7684\u6587\u672C\u6587\u4EF6\u3002 ",-1)),s("div",W,[s("div",X,[t[9]||(t[9]=s("label",null,"\u540D\u79F0",-1)),x(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>d.name=n),placeholder:"\u5982\uFF1A\u672C\u673A-\u9879\u76EE\u6587\u6863"},null,512),[[T,d.name]])]),s("div",Z,[t[10]||(t[10]=s("label",null,"\u76EE\u5F55\u8DEF\u5F84",-1)),x(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>d.path=n),placeholder:"\u5982\uFF1A/Users/xxx/Documents/project-notes"},null,512),[[T,d.path]])]),s("div",tt,[s("button",{class:"btn btn-primary",onClick:E,disabled:f.value},[f.value?(o(),a("span",nt,"\u6DFB\u52A0\u4E2D...")):(o(),a("span",et,"\u6DFB\u52A0\u6587\u4EF6\u5939"))],8,st)])]),s("div",at,[t[11]||(t[11]=s("label",{style:{"font-size":"11px",color:"var(--text-soft)"}},"\u641C\u7D22\uFF1A",-1)),x(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>_.value=n),placeholder:"\u6309\u540D\u79F0\u6216\u8DEF\u5F84\u8FC7\u6EE4"},null,512),[[T,_.value]]),s("button",{class:"btn btn-secondary",onClick:b},"\u91CD\u8F7D")]),s("div",ot,[c.length===0?(o(),a("div",lt," \u8FD8\u6CA1\u6709\u914D\u7F6E\u4EFB\u4F55\u76D1\u63A7\u6587\u4EF6\u5939\uFF0C\u8BF7\u5148\u5728\u4E0A\u65B9\u6DFB\u52A0\u3002 ")):v("",!0),(o(!0),a(y,null,S(M.value,n=>(o(),a("div",{key:n.id,class:"folder-row"},[s("div",rt,[s("div",it,l(n.name),1),s("div",dt,l(n.path),1),s("div",ct,[s("span",null,[t[12]||(t[12]=m(" \u6700\u8FD1\u626B\u63CF\uFF1A ",-1)),n.last_scan_at?(o(),a(y,{key:0},[m(l(w(n.last_scan_at))+"\uFF08"+l(n.last_scan_status||"\u672A\u77E5\u72B6\u6001")+"\uFF09 ",1)],64)):(o(),a(y,{key:1},[m("\u5C1A\u672A\u626B\u63CF")],64))])])]),s("div",null,[n.currentJob?(o(),a("div",ut,[s("div",null,[t[13]||(t[13]=m(" \u72B6\u6001\uFF1A",-1)),s("strong",null,l(C(n.currentJob.status)),1),m(" \uFF08"+l(n.currentJob.processed_files)+" / "+l(n.currentJob.total_files)+" \u6587\u4EF6\uFF09 ",1)]),s("div",pt,[s("div",{class:"progress-inner",style:z({width:J(n.currentJob)+"%"})},null,4)])])):v("",!0)]),s("div",vt,[s("button",{class:"btn btn-primary",onClick:r=>P(n),disabled:n.scanning},[n.scanning?(o(),a("span",mt,"\u626B\u63CF\u4E2D...")):(o(),a("span",ht,"\u626B\u63CF\u5E76\u5411\u91CF\u5316"))],8,_t),s("button",{class:"btn btn-secondary",onClick:r=>N()},"\u5728 Chat \u4E2D\u63D0\u95EE",8,ft),s("button",{class:"btn btn-danger",onClick:r=>A(n)},"\u5220\u9664\u914D\u7F6E",8,bt)])]))),128))])]),s("div",yt,[s("div",{class:"panel-header"},[t[15]||(t[15]=s("div",{class:"panel-title"},"\u626B\u63CF\u4EFB\u52A1 / \u8FDB\u5EA6",-1)),s("button",{class:"btn btn-secondary",onClick:g},"\u5237\u65B0")]),t[16]||(t[16]=s("div",{class:"panel-desc"},"\u67E5\u770B\u5F53\u524D\u548C\u5386\u53F2\u626B\u63CF\u4EFB\u52A1\u7684\u8FDB\u5EA6\uFF0C\u4FBF\u4E8E\u8DDF\u8E2A\u6279\u91CF\u5411\u91CF\u5316\u8FC7\u7A0B\u3002",-1)),s("div",gt,[h.length===0?(o(),a("div",wt," \u6682\u65E0\u626B\u63CF\u4EFB\u52A1\u3002\u4F60\u53EF\u4EE5\u5728\u5DE6\u4FA7\u5BF9\u67D0\u4E2A\u6587\u4EF6\u5939\u53D1\u8D77\u4E00\u6B21\u626B\u63CF\u3002 ")):v("",!0),(o(!0),a(y,null,S(h,n=>(o(),a("div",{key:n.id,class:"job-row"},[s("div",kt,[s("div",null,"\u4EFB\u52A1 "+l(n.id.slice(0,8))+"...",1),s("div",{class:U(["job-status",n.status])},l(C(n.status)),3)]),s("div",$t,[s("span",null,"\u6587\u4EF6\u6570\uFF1A"+l(n.processed_files)+" / "+l(n.total_files),1),s("span",null,"\u5F00\u59CB\uFF1A"+l(w(n.started_at)),1)]),n.finished_at?(o(),a("div",xt,[s("span",null,"\u7ED3\u675F\uFF1A"+l(w(n.finished_at)),1),n.error_message?(o(),a("span",Tt,l(n.error_message),1)):v("",!0)])):v("",!0)]))),128))]),i.value?(o(),a("div",Ct,"\u26A0\uFE0F "+l(i.value),1)):v("",!0)])])]),t[17]||(t[17]=B('<div class="shell-footer" data-v-1dde5b04><div class="footer-left" data-v-1dde5b04><span data-v-1dde5b04>LocalMind \xB7 \u7BA1\u7406\u63A7\u5236\u53F0</span><span class="footer-status" data-v-1dde5b04>\u5B9E\u65F6\u76D1\u63A7\u6587\u4EF6\u5939\u53CA\u626B\u63CF\u4EFB\u52A1</span></div><div class="footer-links" data-v-1dde5b04><a href="/chat" data-v-1dde5b04>Chat</a><a href="/vectors" data-v-1dde5b04>Vectors</a></div></div>',1))]))}};var Et=j(St,[["__scopeId","data-v-1dde5b04"]]);O(Et).mount("#app");
